# ä¸€ã€å‰ç½®çŸ¥è¯†

ä»¥ä¸‹ä¸ºç»“åˆè®­ç»ƒè¥ã€ç½‘ç»œèµ„æ–™ä¸GPTçš„æ•´åˆï¼Œä¸ä¹CVå·¥ç¨‹ï¼Œä½†æ±‚çœ‹æ‡‚çœ‹æ˜ç™½ã€‚

## 1.Agent

### 1.1 å®šä¹‰

> æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼Œä½œä¸ºäººå·¥æ™ºèƒ½é¢†åŸŸçš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œæ˜¯æŒ‡èƒ½å¤Ÿè‡ªä¸»æ„ŸçŸ¥ç¯å¢ƒã€åšå‡ºå†³ç­–å¹¶æ‰§è¡Œè¡ŒåŠ¨çš„ç³»ç»Ÿã€‚å®ƒå…·å¤‡è‡ªä¸»æ€§ã€äº¤äº’æ€§ã€ååº”æ€§å’Œé€‚åº”æ€§ç­‰åŸºæœ¬ç‰¹å¾ï¼Œèƒ½å¤Ÿåœ¨å¤æ‚å¤šå˜çš„ç¯å¢ƒä¸­ç‹¬ç«‹å®Œæˆä»»åŠ¡ã€‚æ™ºèƒ½ä½“çš„å‡ºç°ï¼Œæ ‡å¿—ç€äººå·¥æ™ºèƒ½ä»ç®€å•çš„è§„åˆ™åŒ¹é…å’Œè®¡ç®—æ¨¡æ‹Ÿå‘æ›´é«˜çº§åˆ«çš„è‡ªä¸»æ™ºèƒ½è¿ˆè¿›ã€‚
>
> æ™ºèƒ½ä½“çš„æ ¸å¿ƒåœ¨äºå…¶å…·å¤‡çš„å­¦ä¹ å’Œå†³ç­–èƒ½åŠ›ã€‚é€šè¿‡å­¦ä¹ ç®—æ³•å’Œæ•°æ®åˆ†æï¼Œæ™ºèƒ½ä½“èƒ½å¤Ÿä»æµ·é‡æ•°æ®ä¸­æå–æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå½¢æˆè‡ªå·±çš„çŸ¥è¯†åº“ã€‚åœ¨å†³ç­–è¿‡ç¨‹ä¸­ï¼Œæ™ºèƒ½ä½“èƒ½å¤Ÿç»¼åˆè€ƒè™‘å„ç§å› ç´ ï¼Œè¿ç”¨é€»è¾‘æ¨ç†ã€æ¦‚ç‡ç»Ÿè®¡ç­‰æ–¹æ³•ï¼Œåšå‡ºæœ€ä¼˜çš„å†³ç­–ã€‚è¿™ç§èƒ½åŠ›ä½¿å¾—æ™ºèƒ½ä½“åœ¨è§£å†³å¤æ‚é—®é¢˜æ—¶å…·æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ã€‚[^wolai]

ä¹Ÿå°±æ˜¯ç±»äººã€‚å¤§æ¨¡å‹èƒ½åšåˆ°çš„æ˜¯æ ¹æ®æ–‡å­—åé¦ˆä¿¡æ¯ï¼Œæ­¤æ—¶çš„ä¿¡æ¯æ˜¯åŸºäºå·²è®­ç»ƒçš„å†…å®¹ã€‚é‚£éšç€ç½‘ç»œå†…å®¹çš„æµ·é‡ç”Ÿæˆï¼Œè‹¥æƒ³é€šè¿‡å¤§æ¨¡å‹å¾—åˆ°æŸæ–°é—»äº‹ä»¶çš„æœ€æ–°è¿›å±•ï¼Œæ­¤æ—¶çš„å›å¤å¯èƒ½å¹¶ä¸æ­£ç¡®ã€‚å› æ­¤ï¼Œè‹¥èƒ½ä½¿å¤§æ¨¡å‹ä½¿ç”¨å·¥å…·è·å–æœ€æ–°å†…å®¹é€å…¥promptä¸­ï¼Œä¾¿å…·æœ‰ä¸æ—¶ä¿±è¿›çš„èƒ½åŠ›ã€‚è¿™åªæ˜¯ä¸€æ–¹é¢ï¼Œä¸ºäº†ä¾¿äºç†è§£æƒ³åˆ°çš„è¿™ä¸ªä¾‹å­ã€‚è‹¥æŠŠæ–°é—»ç½®æ¢æˆä¿¡å·ã€ä¼ æ„Ÿå™¨æ•°æ®ï¼Œæ™ºèƒ½ä½“ä¾¿èƒ½æ ¹æ®è¿™äº›æ•°æ®æ¥åšå‡ºè¡ŒåŠ¨ã€‚

æ¢å¥è¯è¯´ï¼Œä½¿å¾—å¤§æ¨¡å‹å…·å¤‡äº†ä½¿ç”¨å·¥å…·çš„èƒ½åŠ›ã€‚

### 1.2 ä¼˜ç¼ºç‚¹

> æ™ºèƒ½ä½“çš„åŸºæœ¬ç‰¹å¾åœ¨äºå…¶è‡ªä¸»æ€§ã€äº¤äº’æ€§ã€ååº”æ€§å’Œé€‚åº”æ€§ã€‚è¿™äº›ç‰¹å¾ä½¿å¾—æ™ºèƒ½ä½“èƒ½å¤Ÿåœ¨ä¸åŒçš„ç¯å¢ƒä¸­ç‹¬ç«‹è¡ŒåŠ¨ï¼Œä¸å…¶ä»–æ™ºèƒ½ä½“æˆ–äººç±»è¿›è¡Œäº¤äº’ï¼Œå¯¹å¤–éƒ¨åˆºæ¿€åšå‡ºååº”ï¼Œå¹¶æ ¹æ®ç»éªŒè°ƒæ•´è‡ªèº«çš„è¡Œä¸ºã€‚
>
> è‡ªä¸»æ€§æ˜¯æ™ºèƒ½ä½“çš„æ ¸å¿ƒç‰¹å¾ä¹‹ä¸€ï¼Œå®ƒä½¿å¾—æ™ºèƒ½ä½“èƒ½å¤Ÿåœ¨æ²¡æœ‰äººç±»å¹²é¢„çš„æƒ…å†µä¸‹è‡ªä¸»å†³ç­–å’Œè¡ŒåŠ¨ã€‚ä¾‹å¦‚ï¼Œåœ¨æ™ºèƒ½å®¶å±…ç³»ç»Ÿä¸­ï¼Œæ™ºèƒ½ä½“å¯ä»¥æ ¹æ®å®¤å†…æ¸©åº¦å’Œæ¹¿åº¦è‡ªåŠ¨è°ƒèŠ‚ç©ºè°ƒå’ŒåŠ æ¹¿å™¨ï¼Œä»¥æä¾›æœ€èˆ’é€‚çš„å±…ä½ç¯å¢ƒã€‚è¿™ç§è‡ªä¸»å†³ç­–çš„èƒ½åŠ›ä½¿å¾—æ™ºèƒ½ä½“èƒ½å¤Ÿåœ¨å®é™…åº”ç”¨ä¸­å‘æŒ¥å·¨å¤§çš„ä½œç”¨ã€‚
>
> äº¤äº’æ€§æ˜¯æ™ºèƒ½ä½“çš„å¦ä¸€ä¸ªé‡è¦ç‰¹å¾ï¼Œå®ƒä½¿å¾—æ™ºèƒ½ä½“èƒ½å¤Ÿä¸å…¶ä»–æ™ºèƒ½ä½“æˆ–äººç±»è¿›è¡Œäº¤æµå’Œåˆä½œã€‚ä¾‹å¦‚ï¼Œåœ¨è‡ªåŠ¨é©¾é©¶æ±½è½¦ä¸­ï¼Œæ™ºèƒ½ä½“éœ€è¦ä¸äº¤é€šä¿¡å·ç¯ã€å…¶ä»–è½¦è¾†å’Œè¡Œäººè¿›è¡Œäº¤äº’ï¼Œä»¥ç¡®ä¿å®‰å…¨è¡Œé©¶ã€‚é€šè¿‡ä¸å…¶ä»–å®ä½“çš„äº¤äº’ï¼Œæ™ºèƒ½ä½“å¯ä»¥æ›´å¥½åœ°ç†è§£ç¯å¢ƒï¼Œå¹¶åšå‡ºæ›´åŠ æ˜æ™ºçš„å†³ç­–ã€‚è¿™ç§äº¤äº’æ€§ä¹Ÿä½¿å¾—æ™ºèƒ½ä½“åœ¨å›¢é˜Ÿåä½œå’Œäººæœºäº¤äº’ç­‰é¢†åŸŸå…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚
>
> ååº”æ€§æ˜¯æŒ‡æ™ºèƒ½ä½“èƒ½å¤Ÿå¯¹å¤–éƒ¨åˆºæ¿€åšå‡ºåŠæ—¶çš„ååº”ã€‚ä¾‹å¦‚ï¼Œåœ¨æœºå™¨äººé¢†åŸŸä¸­ï¼Œæ™ºèƒ½ä½“éœ€è¦èƒ½å¤Ÿæ„ŸçŸ¥ç¯å¢ƒçš„å˜åŒ–ï¼Œå¹¶åšå‡ºç›¸åº”çš„åŠ¨ä½œæ¥é€‚åº”ã€‚è¿™ç§ååº”æ€§çš„è¦æ±‚ä½¿å¾—æ™ºèƒ½ä½“éœ€è¦å…·å¤‡å¿«é€Ÿçš„å¤„ç†èƒ½åŠ›å’Œå‡†ç¡®çš„æ„ŸçŸ¥èƒ½åŠ›ã€‚é€šè¿‡ä¸æ–­å­¦ä¹ å’Œä¼˜åŒ–ï¼Œæ™ºèƒ½ä½“å¯ä»¥é€æ¸æé«˜è‡ªèº«çš„ååº”é€Ÿåº¦å’Œå‡†ç¡®æ€§ï¼Œä»è€Œæ›´å¥½åœ°é€‚åº”å¤æ‚å¤šå˜çš„ç¯å¢ƒã€‚
>
> é€‚åº”æ€§æ˜¯æ™ºèƒ½ä½“çš„æœ€åä¸€ä¸ªåŸºæœ¬ç‰¹å¾ï¼Œå®ƒä½¿å¾—æ™ºèƒ½ä½“èƒ½å¤Ÿæ ¹æ®ç»éªŒè°ƒæ•´è‡ªèº«çš„è¡Œä¸ºã€‚é€šè¿‡ä¸æ–­å­¦ä¹ å’Œç§¯ç´¯ç»éªŒï¼Œæ™ºèƒ½ä½“å¯ä»¥é€æ¸ä¼˜åŒ–è‡ªèº«çš„å†³ç­–å’Œè¡ŒåŠ¨ç­–ç•¥ï¼Œä»¥é€‚åº”ä¸åŒçš„ç¯å¢ƒå’Œä»»åŠ¡ã€‚è¿™ç§é€‚åº”æ€§çš„è¦æ±‚ä½¿å¾—æ™ºèƒ½ä½“éœ€è¦å…·å¤‡å¼ºå¤§çš„å­¦ä¹ èƒ½åŠ›å’Œè‡ªæˆ‘ä¼˜åŒ–èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œåœ¨æ™ºèƒ½æ¨èç³»ç»Ÿä¸­ï¼Œæ™ºèƒ½ä½“éœ€è¦æ ¹æ®ç”¨æˆ·çš„åé¦ˆå’Œè¡Œä¸ºæ•°æ®ä¸æ–­è°ƒæ•´æ¨èç­–ç•¥ï¼Œä»¥æé«˜æ¨èçš„å‡†ç¡®æ€§å’Œç”¨æˆ·æ»¡æ„åº¦ã€‚
>
> æ™ºèƒ½ä½“çš„åŸºæœ¬ç‰¹å¾ä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨ä¸åŒé¢†åŸŸä¸­å‘æŒ¥å·¨å¤§çš„ä½œç”¨ã€‚éšç€æŠ€æœ¯çš„ä¸æ–­å‘å±•å’Œä¼˜åŒ–ï¼Œæ™ºèƒ½ä½“çš„åº”ç”¨å‰æ™¯å°†è¶Šæ¥è¶Šå¹¿é˜”ã€‚æ­£å¦‚è‘—åç§‘å­¦å®¶éœé‡‘æ‰€è¯´ï¼šâ€œäººå·¥æ™ºèƒ½çš„å‘å±•å°†æ”¹å˜æˆ‘ä»¬çš„ç”Ÿæ´»ï¼Œå…¶æ½œåŠ›æ¯”ç«æˆ–ç”µæ›´å¤§ã€‚â€æ™ºèƒ½ä½“çš„å‡ºç°å’Œå‘å±•å°†ä¸ºæˆ‘ä»¬å¸¦æ¥æ›´å¤šçš„ä¾¿åˆ©å’Œåˆ›æ–°ã€‚[^wolai]

### 1.3 ä¸¤ç§èŒƒå¼

#### 1.3.1 é€šç”¨æ™ºèƒ½ä½“èŒƒå¼

> è¿™ç§èŒƒå¼å¼ºè°ƒæ¨¡å‹æ— éœ€ä¾èµ–ç‰¹å®šçš„ç‰¹æ®Šæ ‡è®°ï¼ˆspecial tokenï¼‰æ¥å®šä¹‰å·¥å…·è°ƒç”¨çš„å‚æ•°è¾¹ç•Œã€‚æ¨¡å‹ä¾é å…¶å¼ºå¤§çš„æŒ‡ä»¤è·Ÿéšä¸æ¨ç†èƒ½åŠ›ï¼Œåœ¨æŒ‡å®šçš„**system prompt**æ¡†æ¶ä¸‹ï¼Œæ ¹æ®ä»»åŠ¡éœ€æ±‚è‡ªåŠ¨ç”Ÿæˆå“åº”ã€‚è¿™ç§æ–¹å¼è®©æ¨¡å‹åœ¨æ¨ç†è¿‡ç¨‹ä¸­èƒ½æ›´çµæ´»åœ°é€‚åº”å¤šç§ä»»åŠ¡ï¼Œä¸éœ€è¦å¯¹Tokenizerè¿›è¡Œç‰¹æ®Šè®¾è®¡ã€‚
>
> **ä¼˜åŠ¿**ï¼š
>
> - çµæ´»é€‚åº”ä¸åŒä»»åŠ¡ï¼Œæ— éœ€è®¾è®¡å’Œç»´æŠ¤å¤æ‚çš„æ ‡è®°ç³»ç»Ÿã€‚
> - é€‚åˆå¿«é€Ÿè¿­ä»£ï¼Œé™ä½å¾®è°ƒå’Œéƒ¨ç½²çš„å¤æ‚æ€§ã€‚
> - æ›´æ˜“ä¸å¤šæ¨¡æ€è¾“å…¥ï¼ˆå¦‚æ–‡æœ¬å’Œå›¾åƒï¼‰ç»“åˆï¼Œæ‰©å±•æ¨¡å‹çš„é€šç”¨æ€§ã€‚
>
> **åŠ£åŠ¿**ï¼š
>
> - ç”±äºæ²¡æœ‰æ˜ç¡®æ ‡è®°ï¼Œè°ƒç”¨å·¥å…·æ—¶çš„é”™è¯¯éš¾ä»¥æ•æ‰å’Œçº æ­£ã€‚
> - åœ¨å¤æ‚ä»»åŠ¡ä¸­ï¼Œæ¨¡å‹ç”Ÿæˆå¯èƒ½ä¸å¤Ÿç²¾å‡†ï¼Œå¯¼è‡´å·¥å…·è°ƒç”¨çš„å‡†ç¡®æ€§ä¸‹é™ã€‚
>
> **ï¼ˆ1ï¼‰ReAct**ï¼šå°†æ¨¡å‹çš„æ¨ç†åˆ†ä¸º**Reason**å’Œ**Action**ä¸¤ä¸ªæ­¥éª¤ï¼Œå¹¶è®©å®ƒä»¬äº¤æ›¿æ‰§è¡Œï¼Œç›´åˆ°å¾—åˆ°æœ€ç»ˆç»“æœï¼š
>
> - **Reason**ï¼šç”Ÿæˆåˆ†ææ­¥éª¤ï¼Œè§£é‡Šå½“å‰ä»»åŠ¡çš„ä¸Šä¸‹æ–‡æˆ–çŠ¶æ€ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£ä¸‹ä¸€æ­¥è¡ŒåŠ¨çš„é€»è¾‘ä¾æ®ã€‚
> - **Action**ï¼šåŸºäºReasonçš„ç»“æœï¼Œç”Ÿæˆå…·ä½“çš„å·¥å…·è°ƒç”¨è¯·æ±‚ï¼ˆå¦‚æŸ¥è¯¢æœç´¢å¼•æ“ã€è°ƒç”¨APIã€æ•°æ®åº“æ£€ç´¢ç­‰ï¼‰ï¼Œå°†æ¨¡å‹çš„æ¨ç†è½¬åŒ–ä¸ºè¡ŒåŠ¨ã€‚
>
> **ï¼ˆ2ï¼‰ReWoo**ï¼šå…¨ç§°ä¸º**Reason without Observation**ï¼Œæ˜¯åœ¨ReActèŒƒå¼åŸºç¡€ä¸Šè¿›è¡Œæ”¹è¿›çš„Agentæ¶æ„ï¼Œé’ˆå¯¹å¤šå·¥å…·è°ƒç”¨çš„å¤æ‚æ€§ä¸å†—ä½™æ€§æä¾›äº†ä¸€ç§é«˜æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚ç›¸æ¯”äºReActä¸­çš„äº¤æ›¿æ¨ç†å’Œè¡ŒåŠ¨ï¼ŒReWooç›´æ¥ç”Ÿæˆä¸€æ¬¡æ€§ä½¿ç”¨çš„**å®Œæ•´å·¥å…·é“¾**ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„Tokenæ¶ˆè€—å’Œæ‰§è¡Œæ—¶é—´ã€‚åŒæ—¶ï¼Œç”±äºå·¥å…·è°ƒç”¨çš„è§„åˆ’ä¸æ‰§è¡Œè§£è€¦ï¼Œè¿™ä¸€èŒƒå¼åœ¨æ¨¡å‹å¾®è°ƒæ—¶ä¸éœ€è¦å®é™…è°ƒç”¨å·¥å…·å³å¯å®Œæˆã€‚
>
> - **Planner**ï¼šç”¨æˆ·è¾“å…¥çš„é—®é¢˜æˆ–ä»»åŠ¡é¦–å…ˆä¼ é€’ç»™Plannerï¼ŒPlannerå°†å…¶åˆ†è§£ä¸ºå¤šä¸ªé€»è¾‘ä¸Šç›¸å…³çš„è®¡åˆ’ã€‚æ¯ä¸ªè®¡åˆ’åŒ…å«æ¨ç†éƒ¨åˆ†ï¼ˆReasonï¼‰ä»¥åŠå·¥å…·è°ƒç”¨å’Œå‚æ•°ï¼ˆExecutionï¼‰ã€‚Task ListæŒ‰é¡ºåºåˆ—å‡ºæ‰€æœ‰éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡é“¾ã€‚
> - **Worker**ï¼šæ¯ä¸ªWorkeræ ¹æ®Task Listä¸­çš„å­ä»»åŠ¡ï¼Œè°ƒç”¨æŒ‡å®šå·¥å…·å¹¶è¿”å›ç»“æœã€‚æ‰€æœ‰Workerä¹‹é—´é€šè¿‡å…±äº«çŠ¶æ€ä¿æŒä»»åŠ¡æ‰§è¡Œçš„è¿ç»­æ€§ã€‚
> - **Solveré˜¶æ®µ**ï¼šWorkerå®Œæˆä»»åŠ¡åï¼Œå°†æ‰€æœ‰ç»“æœåŒæ­¥åˆ°Solverã€‚Solverä¼šå¯¹è¿™äº›ç»“æœè¿›è¡Œæ•´åˆï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆçš„ç­”æ¡ˆæˆ–è§£å†³æ–¹æ¡ˆè¿”å›ç»™ç”¨æˆ·ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥èŒƒå¼ä¸‹çš„æ™ºèƒ½ä½“ï¼Œå…·å¤‡æ™®é€‚æ€§ã€‚åªéœ€è¦åœ¨promptä¸­å¤šæŒ‡å®šäº›ä¿¡æ¯å°±èƒ½å¤Ÿå®Œæˆæ™ºèƒ½ä½“çš„åŠ¨ä½œã€‚

#### 1.3.2 æ¨¡å‹ç‰¹åŒ–æ™ºèƒ½ä½“èŒƒå¼

> åœ¨è¿™ç§èŒƒå¼ä¸‹ï¼Œæ¨¡å‹çš„å·¥å…·è°ƒç”¨å¿…é¡»é€šè¿‡ç‰¹å®šçš„**special token**æ˜ç¡®æ ‡è®°ã€‚å¦‚InternLM2ä½¿ç”¨`<|action_start|>`å’Œ`<|action_end|>`æ¥å®šä¹‰è°ƒç”¨è¾¹ç•Œã€‚è¿™äº›æ ‡è®°é€šå¸¸ä¸æ¨¡å‹çš„Tokenizeræ·±åº¦é›†æˆï¼Œç¡®ä¿åœ¨æ‰§è¡Œç‰¹å®šä»»åŠ¡æ—¶ï¼Œèƒ½å¤Ÿå‡†ç¡®æ•æ‰è°ƒç”¨ä¿¡æ¯å¹¶æ‰§è¡Œã€‚
>
> **ä¼˜åŠ¿**ï¼š
>
> - ç‰¹å®šæ ‡è®°æ˜ç¡®å·¥å…·è°ƒç”¨çš„èµ·æ­¢ç‚¹ï¼Œæé«˜äº†è°ƒç”¨çš„å‡†ç¡®æ€§ã€‚
> - æœ‰åŠ©äºæ¨¡å‹åœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é¿å…è¯¯è°ƒç”¨ï¼Œå¢å¼ºç³»ç»Ÿçš„å¯æ§æ€§ã€‚
> - æé«˜å¯¹å¤æ‚è°ƒç”¨é“¾çš„æ”¯æŒï¼Œé€‚åˆå¤æ‚ä»»åŠ¡çš„åœºæ™¯ã€‚
>
> **åŠ£åŠ¿**ï¼š
>
> - éœ€è¦å¯¹Tokenizerå’Œæ¨¡å‹æ¶æ„è¿›è¡Œå®šåˆ¶ï¼Œå¢åŠ å¼€å‘å’Œç»´æŠ¤æˆæœ¬ã€‚
> - è°ƒç”¨æµç¨‹å›ºå®šï¼Œé™ä½äº†æ¨¡å‹çš„çµæ´»æ€§ï¼Œéš¾ä»¥é€‚åº”å¿«é€Ÿå˜åŒ–çš„ä»»åŠ¡ã€‚
>
> **ï¼ˆ1ï¼‰InternLM2æ¡ˆä¾‹åˆ†æï¼š** å·¥å…·è°ƒç”¨ä½¿ç”¨äº†å¦‚`<|plugin|>`ã€`<|interpreter|>`ã€`<|action_start|>`å’Œ`<|action_end|>`ç­‰ç‰¹æ®Šæ ‡è®°ï¼Œç¡®ä¿æ¯ä¸ªè°ƒç”¨éƒ½ç¬¦åˆæŒ‡å®šçš„æ ¼å¼ã€‚æ¨¡å‹åœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¾é è¿™äº›æ ‡è®°ä¸ç³»ç»Ÿç´§å¯†åä½œï¼Œä¿éšœä»»åŠ¡çš„ç²¾å‡†æ‰§è¡Œã€‚æ–‡æ¡£é“¾æ¥ï¼š[InternLM-Chat Agent](https://github.com/InternLM/InternLM/tree/main/agent)

ç†è§£ï¼šä¸éœ€è¦å†åœ¨æç¤ºè¯é‡Œé¢å¤šè¯´ä»€ä¹ˆï¼Œå› ä¸ºæ¨¡å‹å·²ç»è®¾ç½®å¥½äº†ã€‚

### 1.4 åº”ç”¨åœºæ™¯

#### æ™ºèƒ½å®¶å±…

> æ™ºèƒ½ä½“åœ¨æ™ºèƒ½å®¶å±…ä¸­çš„åº”ç”¨å·²ç»æ—¥ç›Šæ™®åŠï¼Œå®ƒä»¬é€šè¿‡é›†æˆå…ˆè¿›çš„AIæŠ€æœ¯ï¼Œä¸ºå®¶åº­å¸¦æ¥äº†å‰æ‰€æœªæœ‰çš„ä¾¿æ·å’Œèˆ’é€‚ã€‚ä»¥æ™ºèƒ½éŸ³ç®±ä¸ºä¾‹ï¼Œäºšé©¬é€Šçš„Echoå’Œè°·æ­Œçš„Homeç­‰æ™ºèƒ½éŸ³ç®±ï¼Œé€šè¿‡è¯­éŸ³è¯†åˆ«å’Œè‡ªç„¶è¯­è¨€å¤„ç†æŠ€æœ¯ï¼Œèƒ½å¤Ÿå“åº”ç”¨æˆ·çš„è¯­éŸ³æŒ‡ä»¤ï¼Œæ§åˆ¶å®¶ä¸­çš„å„ç§æ™ºèƒ½è®¾å¤‡ï¼Œå¦‚ç¯å…‰ã€ç©ºè°ƒã€ç”µè§†ç­‰ã€‚æ®å¸‚åœºç ”ç©¶å…¬å¸Strategy Analyticsçš„æ•°æ®æ˜¾ç¤ºï¼Œåˆ°2023å¹´å…¨çƒæ™ºèƒ½éŸ³ç®±çš„å‡ºè´§é‡é¢„è®¡å°†è¶…è¿‡2.2äº¿å°ï¼Œæ˜¾ç¤ºå‡ºæ™ºèƒ½ä½“åœ¨æ™ºèƒ½å®¶å±…é¢†åŸŸçš„å·¨å¤§å¸‚åœºæ½œåŠ›ã€‚
>
> æ™ºèƒ½ä½“åœ¨æ™ºèƒ½å®¶å±…ä¸­çš„åº”ç”¨ä¸ä»…é™äºè¯­éŸ³æ§åˆ¶ã€‚å®ƒä»¬è¿˜å¯ä»¥é€šè¿‡å­¦ä¹ å’Œé€‚åº”å®¶åº­æˆå‘˜çš„ä¹ æƒ¯å’Œéœ€æ±‚ï¼Œå®ç°æ›´åŠ æ™ºèƒ½åŒ–çš„å®¶å±…ç®¡ç†ã€‚ä¾‹å¦‚ï¼Œæ™ºèƒ½æ’æ¸©å™¨å¯ä»¥æ ¹æ®å®¶åº­æˆå‘˜çš„ä½œæ¯æ—¶é—´å’Œå®¤å†…æ¸©åº¦è‡ªåŠ¨è°ƒèŠ‚æš–æ°”æˆ–ç©ºè°ƒï¼Œä»¥è¾¾åˆ°èŠ‚èƒ½å’Œèˆ’é€‚çš„æ•ˆæœã€‚æ®ç¾å›½èƒ½æºéƒ¨çš„ä¸€é¡¹ç ”ç©¶ï¼Œä½¿ç”¨æ™ºèƒ½æ’æ¸©å™¨å¯ä»¥èŠ‚çœçº¦10%çš„èƒ½æºæˆæœ¬ã€‚

- åº”ç”¨ï¼šæ™ºèƒ½éŸ³ç®±ï¼Œæ™ºèƒ½æ’æ¸©å™¨ã€‚
- ç›®æ ‡ï¼šè‡ªåŠ¨è°ƒæ•´è®¾å¤‡ï¼ŒèŠ‚çº¦èƒ½æºã€‚
- ä¼ æ„Ÿå™¨ï¼šè¯­éŸ³æŒ‡ä»¤ï¼Œå®¶åº­ä¹ æƒ¯ã€‚
- æ‰§è¡Œå™¨ï¼šç¯å…‰ç©ºè°ƒç”µè§†å¼€å…³ã€æ¸©åº¦è°ƒèŠ‚ã€‚



# äºŒã€å®è·µè¿‡ç¨‹

## 1.é…ç½®ç¯å¢ƒ

```bash
# åˆ›å»ºç¯å¢ƒ
conda create -n lagent python=3.10 -y
# æ¿€æ´»ç¯å¢ƒ
conda activate lagent
# å®‰è£… torch
conda install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 pytorch-cuda=12.1 -c pytorch -c nvidia -y
# å®‰è£…å…¶ä»–ä¾èµ–åŒ…
pip install termcolor==2.4.0
pip install streamlit==1.39.0
pip install class_registry==2.1.2
pip install datasets==3.1.0
```

![image-20250211173620183](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211173620234.png)

![image-20250211173840442](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211173840497.png)



æºç æ–¹å¼å®‰è£…æ¡†æ¶lagent

```bash
# åˆ›å»ºç›®å½•ä»¥å­˜æ”¾ä»£ç 
mkdir -p /root/agent_camp4
cd /root/agent_camp4
git clone https://github.com/InternLM/lagent.git
cd lagent && git checkout e304e5d && pip install -e . && cd ..
pip install griffe==0.48.0
```



## 2.agentä¹‹å·²æœ‰æ’ä»¶

ç”³è¯·API

![image-20250211174453852](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211174453926.png)

å†™å…¥ç¯å¢ƒå˜é‡ğŸ‘‡

> ```bash
> export token='your_token_here'
> ```

å®ç°web_api_demo.py

> ```python
> import copy
> import os
> from typing import List
> import streamlit as st
> from lagent.actions import ArxivSearch
> from lagent.prompts.parsers import PluginParser
> from lagent.agents.stream import INTERPRETER_CN, META_CN, PLUGIN_CN, AgentForInternLM, get_plugin_prompt
> from lagent.llms import GPTAPI
> 
> class SessionState:
>     """ç®¡ç†ä¼šè¯çŠ¶æ€çš„ç±»ã€‚"""
> 
>     def init_state(self):
>         """åˆå§‹åŒ–ä¼šè¯çŠ¶æ€å˜é‡ã€‚"""
>         st.session_state['assistant'] = []  # åŠ©æ‰‹æ¶ˆæ¯å†å²
>         st.session_state['user'] = []  # ç”¨æˆ·æ¶ˆæ¯å†å²
>         # åˆå§‹åŒ–æ’ä»¶åˆ—è¡¨
>         action_list = [
>             ArxivSearch(),
>         ]
>         st.session_state['plugin_map'] = {action.name: action for action in action_list}
>         st.session_state['model_map'] = {}  # å­˜å‚¨æ¨¡å‹å®ä¾‹
>         st.session_state['model_selected'] = None  # å½“å‰é€‰å®šæ¨¡å‹
>         st.session_state['plugin_actions'] = set()  # å½“å‰æ¿€æ´»æ’ä»¶
>         st.session_state['history'] = []  # èŠå¤©å†å²
>         st.session_state['api_base'] = None  # åˆå§‹åŒ–API baseåœ°å€
> 
>     def clear_state(self):
>         """æ¸…é™¤å½“å‰ä¼šè¯çŠ¶æ€ã€‚"""
>         st.session_state['assistant'] = []
>         st.session_state['user'] = []
>         st.session_state['model_selected'] = None
> 
> 
> class StreamlitUI:
>     """ç®¡ç† Streamlit ç•Œé¢çš„ç±»ã€‚"""
> 
>     def __init__(self, session_state: SessionState):
>         self.session_state = session_state
>         self.plugin_action = []  # å½“å‰é€‰å®šçš„æ’ä»¶
>         # åˆå§‹åŒ–æç¤ºè¯
>         self.meta_prompt = META_CN
>         self.plugin_prompt = PLUGIN_CN
>         self.init_streamlit()
> 
>     def init_streamlit(self):
>         """åˆå§‹åŒ– Streamlit çš„ UI è®¾ç½®ã€‚"""
>         st.set_page_config(
>             layout='wide',
>             page_title='lagent-web',
>             page_icon='./docs/imgs/lagent_icon.png'
>         )
>         st.header(':robot_face: :blue[Lagent] Web Demo ', divider='rainbow')
> 
>     def setup_sidebar(self):
>         """è®¾ç½®ä¾§è¾¹æ ï¼Œé€‰æ‹©æ¨¡å‹å’Œæ’ä»¶ã€‚"""
>         # æ¨¡å‹åç§°å’Œ API Base è¾“å…¥æ¡†
>         model_name = st.sidebar.text_input('æ¨¡å‹åç§°ï¼š', value='internlm2.5-latest')
>         
>         # ================================== ç¡…åŸºæµåŠ¨çš„API ==================================
>         # æ³¨æ„ï¼Œå¦‚æœé‡‡ç”¨ç¡…åŸºæµåŠ¨APIï¼Œæ¨¡å‹åç§°éœ€è¦æ›´æ”¹ä¸ºï¼šinternlm/internlm2_5-7b-chat æˆ–è€… internlm/internlm2_5-20b-chat
>         # api_base = st.sidebar.text_input(
>         #     'API Base åœ°å€ï¼š', value='https://api.siliconflow.cn/v1/chat/completions'
>         # )
>         # ================================== æµ¦è¯­å®˜æ–¹çš„API ==================================
>         api_base = st.sidebar.text_input(
>             'API Base åœ°å€ï¼š', value='https://internlm-chat.intern-ai.org.cn/puyu/api/v1/chat/completions'
>         )
>         # ==================================================================================
>         # æ’ä»¶é€‰æ‹©
>         plugin_name = st.sidebar.multiselect(
>             'æ’ä»¶é€‰æ‹©',
>             options=list(st.session_state['plugin_map'].keys()),
>             default=[],
>         )
> 
>         # æ ¹æ®é€‰æ‹©çš„æ’ä»¶ç”Ÿæˆæ’ä»¶æ“ä½œåˆ—è¡¨
>         self.plugin_action = [st.session_state['plugin_map'][name] for name in plugin_name]
> 
>         # åŠ¨æ€ç”Ÿæˆæ’ä»¶æç¤º
>         if self.plugin_action:
>             self.plugin_prompt = get_plugin_prompt(self.plugin_action)
> 
>         # æ¸…ç©ºå¯¹è¯æŒ‰é’®
>         if st.sidebar.button('æ¸…ç©ºå¯¹è¯', key='clear'):
>             self.session_state.clear_state()
> 
>         return model_name, api_base, self.plugin_action
> 
>     def initialize_chatbot(self, model_name, api_base, plugin_action):
>         """åˆå§‹åŒ– GPTAPI å®ä¾‹ä½œä¸º chatbotã€‚"""
>         token = os.getenv("token")
>         if not token:
>             st.error("æœªæ£€æµ‹åˆ°ç¯å¢ƒå˜é‡ `token`ï¼Œè¯·è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œä¾‹å¦‚ `export token='your_token_here'` åé‡æ–°è¿è¡Œ Xï¹X")
>             st.stop()  # åœæ­¢è¿è¡Œåº”ç”¨
>             
>         # åˆ›å»ºå®Œæ•´çš„ meta_promptï¼Œä¿ç•™åŸå§‹ç»“æ„å¹¶åŠ¨æ€æ’å…¥ä¾§è¾¹æ é…ç½®
>         meta_prompt = [
>             {"role": "system", "content": self.meta_prompt, "api_role": "system"},
>             {"role": "user", "content": "", "api_role": "user"},
>             {"role": "assistant", "content": self.plugin_prompt, "api_role": "assistant"},
>             {"role": "environment", "content": "", "api_role": "environment"}
>         ]
> 
>         api_model = GPTAPI(
>             model_type=model_name,
>             api_base=api_base,
>             key=token,  # ä»ç¯å¢ƒå˜é‡ä¸­è·å–æˆæƒä»¤ç‰Œ
>             meta_template=meta_prompt,
>             max_new_tokens=512,
>             temperature=0.8,
>             top_p=0.9
>         )
>         return api_model
> 
>     def render_user(self, prompt: str):
>         """æ¸²æŸ“ç”¨æˆ·è¾“å…¥å†…å®¹ã€‚"""
>         with st.chat_message('user'):
>             st.markdown(prompt)
> 
>     def render_assistant(self, agent_return):
>         """æ¸²æŸ“åŠ©æ‰‹å“åº”å†…å®¹ã€‚"""
>         with st.chat_message('assistant'):
>             content = getattr(agent_return, "content", str(agent_return))
>             st.markdown(content if isinstance(content, str) else str(content))
> 
> 
> def main():
>     """ä¸»å‡½æ•°ï¼Œè¿è¡Œ Streamlit åº”ç”¨ã€‚"""
>     if 'ui' not in st.session_state:
>         session_state = SessionState()
>         session_state.init_state()
>         st.session_state['ui'] = StreamlitUI(session_state)
>     else:
>         st.set_page_config(
>             layout='wide',
>             page_title='lagent-web',
>             page_icon='./docs/imgs/lagent_icon.png'
>         )
>         st.header(':robot_face: :blue[Lagent] Web Demo ', divider='rainbow')
> 
>     # è®¾ç½®ä¾§è¾¹æ å¹¶è·å–æ¨¡å‹å’Œæ’ä»¶ä¿¡æ¯
>     model_name, api_base, plugin_action = st.session_state['ui'].setup_sidebar()
>     plugins = [dict(type=f"lagent.actions.{plugin.__class__.__name__}") for plugin in plugin_action]
> 
>     if (
>         'chatbot' not in st.session_state or
>         model_name != st.session_state['chatbot'].model_type or
>         'last_plugin_action' not in st.session_state or
>         plugin_action != st.session_state['last_plugin_action'] or
>         api_base != st.session_state['api_base']    
>     ):
>         # æ›´æ–° Chatbot
>         st.session_state['chatbot'] = st.session_state['ui'].initialize_chatbot(model_name, api_base, plugin_action)
>         st.session_state['last_plugin_action'] = plugin_action  # æ›´æ–°æ’ä»¶çŠ¶æ€
>         st.session_state['api_base'] = api_base  # æ›´æ–° API Base åœ°å€
> 
>         # åˆå§‹åŒ– AgentForInternLM
>         st.session_state['agent'] = AgentForInternLM(
>             llm=st.session_state['chatbot'],
>             plugins=plugins,
>             output_format=dict(
>                 type=PluginParser,
>                 template=PLUGIN_CN,
>                 prompt=get_plugin_prompt(plugin_action)
>             )
>         )
>         # æ¸…ç©ºå¯¹è¯å†å²
>         st.session_state['session_history'] = []
> 
>     if 'agent' not in st.session_state:
>         st.session_state['agent'] = None
> 
>     agent = st.session_state['agent']
>     for prompt, agent_return in zip(st.session_state['user'], st.session_state['assistant']):
>         st.session_state['ui'].render_user(prompt)
>         st.session_state['ui'].render_assistant(agent_return)
> 
>     # å¤„ç†ç”¨æˆ·è¾“å…¥
>     if user_input := st.chat_input(''):
>         st.session_state['ui'].render_user(user_input)
> 
>         # è°ƒç”¨æ¨¡å‹æ—¶ç¡®ä¿ä¾§è¾¹æ çš„ç³»ç»Ÿæç¤ºè¯å’Œæ’ä»¶æç¤ºè¯ç”Ÿæ•ˆ
>         res = agent(user_input, session_id=0)
>         st.session_state['ui'].render_assistant(res)
> 
>         # æ›´æ–°ä¼šè¯çŠ¶æ€
>         st.session_state['user'].append(user_input)
>         st.session_state['assistant'].append(copy.deepcopy(res))
> 
>     st.session_state['last_status'] = None
> 
> 
> if __name__ == '__main__':
>     main()
> 
> ```

å‚è€ƒè¯¾ç¨‹æ–‡æ¡£ä»£ç ï¼Œå¦‚ä¸ŠğŸ‘†å¼•ç”¨å†…å®¹ã€‚

æ¥ç€å¯åŠ¨ğŸ‘‡

```bash
streamlit run agent_api_web_demo.py
```

åœ¨æœ¬åœ°powershellä¸­è¾“å…¥æ‰§è¡Œç«¯å£æ˜ å°„

```bash
ssh -CNg -L 8501:127.0.0.1:8501 root@ssh.intern-ai.org.cn -p <ä½ çš„ SSH ç«¯å£å·>
```

è¯¢é—®gptåçš„ç»“æœğŸ‘‡

> è¿™æ®µå‘½ä»¤ç”¨äºé€šè¿‡SSHå»ºç«‹æœ¬åœ°ä¸è¿œç¨‹æœåŠ¡å™¨ä¹‹é—´çš„éš§é“ï¼Œå…·ä½“è§£æå¦‚ä¸‹ï¼š
>
> 1. **`ssh`**: å¯åŠ¨SSHå®¢æˆ·ç«¯ï¼Œç”¨äºè¿æ¥è¿œç¨‹æœåŠ¡å™¨ã€‚
>
> 2. **`-C`**: å¯ç”¨å‹ç¼©ï¼Œä¼ è¾“æ•°æ®æ—¶è¿›è¡Œå‹ç¼©ï¼Œæå‡é€Ÿåº¦ã€‚
>
> 3. **`-N`**: ä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…ç”¨äºç«¯å£è½¬å‘ã€‚
>
> 4. **`-g`**: å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥æœ¬åœ°è½¬å‘ç«¯å£ã€‚
>
> 5. **`-L 8501:127.0.0.1:8501`**: è®¾ç½®æœ¬åœ°ç«¯å£è½¬å‘ã€‚å°†æœ¬åœ°çš„8501ç«¯å£è½¬å‘åˆ°è¿œç¨‹æœåŠ¡å™¨çš„127.0.0.1:8501ã€‚
>
> 6. **`root@ssh.intern-ai.org.cn`**: ä»¥rootç”¨æˆ·è¿æ¥è¿œç¨‹æœåŠ¡å™¨`ssh.intern-ai.org.cn`ã€‚
>
> 7. **`-p <ä½ çš„ SSH ç«¯å£å·>`**: æŒ‡å®šSSHè¿æ¥çš„ç«¯å£å·ï¼Œæ›¿æ¢`<ä½ çš„ SSH ç«¯å£å·>`ä¸ºå®é™…ç«¯å£ã€‚
>
> **æ€»ç»“**ï¼šè¯¥å‘½ä»¤é€šè¿‡SSHéš§é“å°†æœ¬åœ°çš„8501ç«¯å£è½¬å‘åˆ°è¿œç¨‹æœåŠ¡å™¨çš„8501ç«¯å£ï¼Œé€‚ç”¨äºè®¿é—®è¿œç¨‹æœåŠ¡æˆ–ç»•è¿‡é˜²ç«å¢™ã€‚



ä¸ä½¿ç”¨æ’ä»¶æ—¶ï¼Œè¯¢é—®â€œå¸®æˆ‘æœç´¢æœ€æ–°ç‰ˆæœ¬çš„MindSearchè®ºæ–‡â€œç»“æœå¦‚ä¸‹ğŸ‘‡

![image-20250211183759433](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211183759552.png)



ä½¿ç”¨æ’ä»¶åï¼Œç»“æœå¦‚ä¸‹ğŸ‘‡

![image-20250211183834606](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211183834723.png)





## 3.agentä¹‹diyæ’ä»¶â€”â€”ä»¥å¤©æ°”å·¥å…·ä¸ºä¾‹

æ ¹æ®æ–‡æ¡£è¿›è¡Œä»£ç æ›´æ”¹åï¼Œåœ¨æ²¡æœ‰ä½¿ç”¨æ’ä»¶çš„æƒ…å†µä¸‹ï¼Œè¯¢é—®å¤©æ°”æ—¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºğŸ‘‡

![image-20250211185628793](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211185628931.png)



ä½¿ç”¨æ’ä»¶åï¼Œå¦‚ä¸‹æ‰€ç¤ºğŸ‘‡

![image-20250211185822724](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211185822866.png)

## 4.å¤šæ™ºèƒ½ä½“ä¹‹åšå®¢æ­å»º

![image-20250211191244779](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211191244900.png)

æ‰§è¡Œç»“æœå¦‚ä¸ŠğŸ‘†

## 5.ä¸Šä¼ huggingface

ä¼ é€’å¥½tokenğŸ‘‡

![image-20250211191517703](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211191517761.png)

æµ‹è¯•å¯è§æ€§ğŸ‘‡

![image-20250211191927640](https://typora-urname.oss-cn-beijing.aliyuncs.com/git/20250211191927704.png)

å®éªŒå¤šæ¬¡å¤±è´¥ã€‚å›å¤´å†æ‰¾åŸå› ï¼Œæ¥ç€é—¯å…³äº†â€¦â€¦ğŸ˜‚





# å‚è€ƒèµ„æ–™

[^wolai]: https://www.wolai.com/cUCxuiNAQYJcpaYxCvR1QU

